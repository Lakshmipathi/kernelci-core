#!/usr/bin/env groovy
/*
 * DOCKER_BASE
 *   Dockerhub base address used for the build images
 */
@Library('kernelci') _

def docker_image = "${params.DOCKER_BASE}debos"
//def git_branch = "${params.GIT_BRANCH}"
def rootfs_config = "${params.CONFIG_NAME}"

pipeline {
  options { timestamps() }
  agent none

  stages {
      stage("CHECKOUT") {
         agent {
             label "debos" && "docker"
          }

          steps {
         	checkout changelog: true, poll: true, scm: [
            	 $class: 'GitSCM',
	             branches: [[name: "${params.GIT_BRANCH}"]],
        	     extensions: [[$class: 'PruneStaleBranch']]
	        ]	
	 	script {
                	echo "RUNNing ${env.BUILD_ID} with ${WORKSPACE} against ${params.GIT_BRANCH}"
                    docker.image("${docker_image}").inside("--device /dev/kvm"){ 
           		sh """
                           ls 
                           # python3 ./kci_rootfs build --config ${rootfs_config} \
			   # --data-path jenkins/debian/debos 
			   """
		    }	
        	}	
	  }
	}
  }
}
